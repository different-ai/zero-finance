"use client";

import React, { useRef, useMemo, Suspense, useState, useEffect } from "react";
import { Canvas, useFrame, extend } from "@react-three/fiber";
import { useGLTF, PerspectiveCamera, shaderMaterial } from "@react-three/drei";
import { EffectComposer, Bloom, ChromaticAberration, Noise } from "@react-three/postprocessing";
import { GlitchEffect } from "@/effects/GlitchEffect";
import { BlueNoiseHalftoneEffect } from "@/effects/BlueNoiseHalftoneEffect";
import { HologramEffect } from "@/effects/HologramEffect";
import { DitherWaveEffect } from "@/effects/DitherWaveEffect";
import * as THREE from "three";
import Link from 'next/link';
import Image from 'next/image';
import { StartupCalculatorSection } from '@/components/StartupCalculatorSection';

// 4-color CAD palette - direction-binned, discrete hues
const COLORS = {
  YELLOW: new THREE.Color(0xFFF46B),
  YELLOW_GREEN: new THREE.Color(0xAFFF5A),
  CYAN: new THREE.Color(0x67E2FF),
  BLUE: new THREE.Color(0x3D5BFF),
  RED: new THREE.Color(0xFF5A62), // accent for seams
};

// UV Panel Grid Shader - CAD-style orthogonal panels
const UVGridMaterial = shaderMaterial(
  {
    uFrequency: new THREE.Vector2(24, 36), // spanwise/chordwise panels
    uLineWidth: 0.014,
    uColor: new THREE.Color(0xF3FF6A), // yellow-green tint
  },
  // Vertex shader
  `
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,
  // Fragment shader - crisp CAD panel grid
  `
    uniform vec2 uFrequency;
    uniform float uLineWidth;
    uniform vec3 uColor;
    varying vec2 vUv;

    void main() {
      vec2 grid = fract(vUv * uFrequency);
      float gx = step(grid.x, uLineWidth) + step(1.0 - uLineWidth, grid.x);
      float gy = step(grid.y, uLineWidth) + step(1.0 - uLineWidth, grid.y);
      float gridLine = max(gx, gy);

      if (gridLine < 0.5) discard;

      vec3 finalColor = mix(vec3(1.0), uColor, 0.15);
      gl_FragColor = vec4(finalColor, 1.0);
    }
  `
);

extend({ UVGridMaterial });

// Extend TypeScript types for custom material
declare module '@react-three/fiber' {
  interface ThreeElements {
    uVGridMaterial: any;
  }
}


interface Company {
  id: string;
  name: string;
  tagline: string;
  description: string;
  category: string;
  logo?: string;
  model3d?: string; // Single model (legacy support)
  models3d?: string[]; // Array of 4 models for each section
  website?: string;
  twitter?: string;
  whyWeLoveThem?: string;
  funding: {
    amount: number;
    round: string;
    date: string;
  };
  founders: Array<{
    id: string;
    name: string;
    role: string;
    twitter?: string;
    avatar?: string;
  }>;
  showcase?: {
    emoji?: string;
  };
}

// Model paths for each section
const MODELS = [
  "/GL Transmission Format - Binary.glb", // Section 1: Intro - Shuttle
  "/Apollo Soyuz.glb", // Section 2: Mission - Apollo Soyuz
  "/Extravehicular Mobility Unit.glb", // Section 3: Team - Space Suit
  "/International Space Station (ISS) (A).glb", // Section 4: Potential - ISS
];

// Preload all models
MODELS.forEach((model) => useGLTF.preload(model));

interface WireframeRocketProps {
  scrollProgress: number;
  rotation: { x: number; y: number; z: number };
  scale: number;
  position: { x: number; y: number; z: number };
  customModelPath?: string; // Optional custom model path
}

function WireframeRocket({ scrollProgress, rotation, scale, position, customModelPath }: WireframeRocketProps) {
  // Use custom model if provided, otherwise use default models based on scroll progress
  const modelIndex = Math.min(Math.floor(scrollProgress * 4), 3);
  const modelPath = customModelPath || MODELS[modelIndex];

  const { scene } = useGLTF(modelPath);
  const groupRef = useRef<THREE.Group>(null);

  // Exact copy from PlaygroundClient.tsx - 2-color alternating wireframe
  const colorPalette = useMemo(() => [
    0x1B29FF, // primary blue
    0xFF3D5B, // risograph red
  ], []);

  const edgeLines = useMemo(() => {
    const lines: JSX.Element[] = [];
    let colorIndex = 0;

    scene.traverse((child) => {
      if (child instanceof THREE.Mesh && child.geometry) {
        const edges = new THREE.EdgesGeometry(child.geometry, 20);
        const color = colorPalette[colorIndex % colorPalette.length];
        colorIndex++;

        lines.push(
          <lineSegments key={child.uuid} geometry={edges}>
            <lineBasicMaterial color={color} transparent opacity={1.0} linewidth={1.5} />
          </lineSegments>
        );
      }
    });

    return lines;
  }, [scene, colorPalette, modelPath]);

  useFrame(() => {
    if (groupRef.current) {
      // Slow rotation based on scroll
      groupRef.current.rotation.y = scrollProgress * Math.PI * 2;
    }
  });

  return (
    <group
      ref={groupRef}
      position={[position.x, position.y, position.z]}
      rotation={[rotation.x, rotation.y, rotation.z]}
      scale={scale}
    >
      <primitive object={scene} visible={false} />
      {edgeLines}
    </group>
  );
}

// CRT effect - scanlines, grain, minimal RGB split
function CRTEffect() {
  return (
    <div className="pointer-events-none fixed inset-0 z-50">
      {/* Grain - 2-3% mono */}
      <div
        className="absolute inset-0 opacity-[0.022]"
        style={{
          backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='6.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`,
          backgroundRepeat: 'repeat',
        }}
      />
      {/* Scanlines - faint, ~15-20% opacity */}
      <div
        className="absolute inset-0 opacity-[0.15]"
        style={{
          backgroundImage: 'repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(255,255,255,0.03) 1px, rgba(255,255,255,0.03) 2px)',
        }}
      />
      {/* Cross-shaped subpixel mask - very subtle */}
      <div
        className="absolute inset-0 opacity-[0.26]"
        style={{
          backgroundImage: `
            repeating-linear-gradient(0deg, transparent, transparent 2.8px, rgba(255,255,255,0.015) 2.8px, rgba(255,255,255,0.015) 5.6px),
            repeating-linear-gradient(90deg, transparent, transparent 2.8px, rgba(255,255,255,0.015) 2.8px, rgba(255,255,255,0.015) 5.6px)
          `,
        }}
      />
    </div>
  );
}

interface StartupPageClientProps {
  company: Company;
}

// Section definitions for navigation
const SECTIONS = [
  { id: 'company', label: 'COMPANY', shortLabel: 'INFO', color: '#00FFFF' },
  { id: 'mission', label: 'MISSION', shortLabel: 'MISSION', color: '#00FF00' },
  { id: 'funding', label: 'FUNDING', shortLabel: 'FUNDING', color: '#FFFF00' },
  { id: 'team', label: 'TEAM', shortLabel: 'TEAM', color: '#00FFFF' },
  { id: 'zero', label: 'ZERO_FINANCE', shortLabel: 'CALC', color: '#FF00FF' },
] as const;

export function StartupPageClient({ company }: StartupPageClientProps) {
  const [activeSection, setActiveSection] = useState('company');
  const [isMobile, setIsMobile] = useState(false);

  // Preload custom model if available
  useEffect(() => {
    if (company.model3d) {
      useGLTF.preload(company.model3d);
    }
  }, [company.model3d]);

  // Detect mobile vs desktop
  useEffect(() => {
    const checkMobile = () => setIsMobile(window.innerWidth < 1024);
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  // Track active section on scroll (both mobile and desktop)
  useEffect(() => {
    const handleScroll = () => {
      if (isMobile) {
        // Mobile: sections are inside scrollable div
        const scrollContainer = document.querySelector('.flex-1.bg-black.overflow-y-auto');
        if (!scrollContainer) return;

        const sections = SECTIONS.map(s => document.getElementById(s.id));
        const scrollTop = scrollContainer.scrollTop;
        const containerHeight = scrollContainer.clientHeight;

        for (let i = sections.length - 1; i >= 0; i--) {
          const section = sections[i];
          if (section) {
            const sectionTop = section.offsetTop;
            if (sectionTop <= scrollTop + containerHeight / 2) {
              setActiveSection(SECTIONS[i].id);
              break;
            }
          }
        }
      } else {
        // Desktop: sections are in window scroll
        const sections = SECTIONS.map(s => document.getElementById(s.id));
        const scrollPosition = window.scrollY + window.innerHeight / 2;

        for (let i = sections.length - 1; i >= 0; i--) {
          const section = sections[i];
          if (section && section.offsetTop <= scrollPosition) {
            setActiveSection(SECTIONS[i].id);
            break;
          }
        }
      }
    };

    // Run once on mount
    setTimeout(handleScroll, 100);

    if (isMobile) {
      const scrollContainer = document.querySelector('.flex-1.bg-black.overflow-y-auto');
      if (scrollContainer) {
        scrollContainer.addEventListener('scroll', handleScroll);
        return () => scrollContainer.removeEventListener('scroll', handleScroll);
      }
    } else {
      window.addEventListener('scroll', handleScroll);
      return () => window.removeEventListener('scroll', handleScroll);
    }
  }, [isMobile]);

  const navigateToSection = (sectionId: string) => {
    setActiveSection(sectionId);
    const element = document.getElementById(sectionId);
    if (element) {
      if (isMobile) {
        // On mobile, scroll the container
        const scrollContainer = document.querySelector('.flex-1.bg-black.overflow-y-auto');
        if (scrollContainer) {
          const elementTop = element.offsetTop;
          scrollContainer.scrollTo({ top: elementTop, behavior: 'smooth' });
        }
      } else {
        // On desktop, scroll the window
        element.scrollIntoView({ behavior: 'smooth' });
      }
    }
  };

  const formatCurrency = (value: number) => {
    if (value >= 1000000) {
      return `$${(value / 1000000).toFixed(1)}M`;
    } else if (value >= 1000) {
      return `$${(value / 1000).toFixed(0)}K`;
    }
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  // Independent 3D viewer - each model has its own Canvas, camera, and settings
  const Model3D = ({ modelIndex }: { modelIndex: number }) => {
    const isShuttle = modelIndex === 0;

    // Per-model camera settings (completely independent)
    const modelCamera = isShuttle
      ? { position: [0, 0, 100] as [number, number, number], fov: 75 }
      : { position: [0, 0, 12] as [number, number, number], fov: 75 };

    // Per-model transform settings
    const modelTransform = isShuttle
      ? {
          rotation: { x: -0.80, y: 0.64, z: -2.46 },
          scale: 0.12,
          position: { x: 0, y: 0, z: 0 }
        }
      : {
          rotation: { x: -1.2, y: 0, z: -0.5 },
          scale: 0.9,
          position: { x: 0, y: 0, z: 5.0 }
        };

    return (
      <div className="w-full h-[600px] relative border-t border-b border-[#00FF00]" style={{ backgroundColor: '#000000' }}>
        <Canvas
          camera={{ position: modelCamera.position, fov: modelCamera.fov }}
          dpr={[1, 1.5]} // Limit pixel ratio for performance
          performance={{ min: 0.5 }} // Allow frame skipping if needed
          style={{ backgroundColor: '#000000' }}
        >
          <PerspectiveCamera makeDefault position={modelCamera.position} fov={modelCamera.fov} />

          <ambientLight intensity={0.2} />
          <directionalLight position={[5, 5, 5]} intensity={0.4} />

          <Suspense fallback={null}>
            <WireframeRocket
              scrollProgress={modelIndex / 3}
              rotation={modelTransform.rotation}
              scale={modelTransform.scale}
              position={modelTransform.position}
            />
          </Suspense>

          <EffectComposer>
            {/* Different effect per model */}
            {modelIndex === 0 && (
              <>
                {/* Shuttle: Glitch effect */}
                <Bloom intensity={0.6} luminanceThreshold={0.7} radius={0.3} />
                <primitive object={new GlitchEffect()} />
                <ChromaticAberration offset={[0.005, 0.005]} />
                <Noise opacity={0.05} />
              </>
            )}
            {modelIndex === 1 && (
              <>
                {/* Apollo/Soyuz: Dither Wave */}
                <primitive object={new DitherWaveEffect()} />
                <Bloom intensity={0.4} luminanceThreshold={0.8} radius={0.2} />
              </>
            )}
            {modelIndex === 2 && (
              <>
                {/* Space Suit: Hologram effect */}
                <primitive object={new HologramEffect()} />
                <Bloom intensity={1.2} luminanceThreshold={0.5} radius={0.5} />
              </>
            )}
            {modelIndex === 3 && (
              <>
                {/* ISS: Dither Wave */}
                <primitive object={new DitherWaveEffect()} />
                <Bloom intensity={0.4} luminanceThreshold={0.8} radius={0.2} />
              </>
            )}
          </EffectComposer>
        </Canvas>
      </div>
    );
  };

  return (
    <div className="min-h-screen relative" style={{ backgroundColor: '#000000' }}>
      <CRTEffect />

      {/* Mobile: CAD Interface */}
      {isMobile && (
        <div className="lg:hidden fixed inset-0 bg-black flex flex-col overflow-hidden z-40">
          {/* CAD-style Header Bar */}
          <div className="bg-[#0000AA] text-white font-mono text-[10px] sm:text-xs px-2 py-1 flex items-center justify-between border-b border-[#00FFFF]/30 flex-shrink-0">
            <span className="tracking-wider truncate flex-1 mr-2">ACAD v12 - {company.name.toUpperCase().substring(0, 12)}.DWG</span>
            <span className="text-[#00FFFF] flex-shrink-0">SECT: {SECTIONS.findIndex(s => s.id === activeSection) + 1}/5</span>
          </div>

          {/* 3D Viewport - Top Section */}
          <div className="h-[35vh] bg-black border-b border-[#00FF00]/30 relative flex-shrink-0">
            <Canvas
              key={activeSection}
              camera={{
                position: activeSection === 'company' ? [0, 0, 140] : [0, 0, 15],
                fov: 75
              }}
              dpr={[1, 1.5]}
              performance={{ min: 0.5 }}
              style={{ backgroundColor: '#000000' }}
            >
              <PerspectiveCamera
                makeDefault
                position={activeSection === 'company' ? [0, 0, 140] : [0, 0, 15]}
                fov={75}
              />
              <ambientLight intensity={0.2} />
              <directionalLight position={[5, 5, 5]} intensity={0.4} />
              <Suspense fallback={null}>
                <WireframeRocket
                  scrollProgress={SECTIONS.findIndex(s => s.id === activeSection) / 4}
                  rotation={
                    activeSection === 'company'
                      ? { x: -0.80, y: 0.64, z: -2.46 }
                      : { x: -1.2, y: 0, z: -0.5 }
                  }
                  scale={
                    activeSection === 'company'
                      ? 0.09
                      : 0.7
                  }
                  position={
                    activeSection === 'company'
                      ? { x: 0, y: 0, z: 0 }
                      : { x: 0, y: 0, z: 12.0 }
                  }
                  customModelPath={company.model3d}
                />
              </Suspense>
              <EffectComposer>
                {activeSection === 'company' && (
                  <>
                    <Bloom intensity={0.6} luminanceThreshold={0.7} radius={0.3} />
                    <primitive object={new GlitchEffect()} />
                  </>
                )}
                {activeSection === 'mission' && (
                  <>
                    <primitive object={new DitherWaveEffect()} />
                    <Bloom intensity={0.4} luminanceThreshold={0.8} radius={0.2} />
                  </>
                )}
                {activeSection === 'team' && (
                  <>
                    <primitive object={new HologramEffect()} />
                    <Bloom intensity={1.2} luminanceThreshold={0.5} radius={0.5} />
                  </>
                )}
                {(activeSection === 'funding' || activeSection === 'zero') && (
                  <>
                    <primitive object={new DitherWaveEffect()} />
                    <Bloom intensity={0.4} luminanceThreshold={0.8} radius={0.2} />
                  </>
                )}
              </EffectComposer>
            </Canvas>

            {/* Viewport Label */}
            <div className="absolute top-1 left-1 sm:top-2 sm:left-2 font-mono text-[8px] sm:text-[9px] text-[#00FFFF] uppercase tracking-wider">
              [3D WIREFRAME]
            </div>

            {/* Section Info */}
            <div className="absolute top-1 right-1 sm:top-2 sm:right-2 font-mono text-[8px] sm:text-[9px] text-[#00FF00] space-y-0.5 text-right">
              <div>LAYER: {activeSection.toUpperCase()}</div>
            </div>

            {/* Section Navigation Buttons */}
            <div className="absolute bottom-1 left-1 right-1 sm:bottom-2 sm:left-2 sm:right-2 flex gap-0.5 sm:gap-1">
              {SECTIONS.map((s) => (
                <button
                  key={s.id}
                  onClick={() => navigateToSection(s.id)}
                  className={`flex-1 py-1 sm:py-1.5 transition-all border font-mono text-[8px] sm:text-[9px] font-bold uppercase ${
                    s.id === activeSection
                      ? 'bg-[#00FF00] border-[#00FF00] text-black'
                      : 'bg-black/80 border-[#00FF00]/30 text-[#00FF00] hover:border-[#00FFFF] hover:text-[#00FFFF]'
                  }`}
                >
                  {s.shortLabel}
                </button>
              ))}
            </div>
          </div>

          {/* Scrollable Content Area */}
          <div className="flex-1 bg-black overflow-y-auto border-t-2 border-[#00FF00] min-h-0">
            <div className="p-3 sm:p-4 space-y-4">

              {/* SECTION 1: COMPANY */}
              <div id="company" className="scroll-mt-4">
                <div className="border border-[#00FFFF]/30 bg-[#0000AA]/20 p-2 mb-3">
                  <div className="font-mono text-[9px] sm:text-[10px] text-[#FF00FF] uppercase tracking-wider">
                    &gt;&gt; SECT_01: COMPANY
                  </div>
                </div>

                <div className="space-y-3">
                  <div className="inline-block px-2 py-1 bg-black border border-[#00FF00] text-[9px] sm:text-[10px] text-[#00FF00] font-mono font-bold uppercase tracking-wider">
                    CAT: {company.category.toUpperCase()}
                  </div>

                  <h1 className="text-3xl sm:text-4xl font-black tracking-tight leading-none uppercase font-mono text-[#00FFFF] break-words">
                    {company.name.toUpperCase()}
                  </h1>

                  <p className="text-sm sm:text-base font-mono tracking-wide uppercase font-bold text-[#00FF00] break-words">
                    // {company.tagline.toUpperCase()}
                  </p>

                  <div className="border-2 border-[#00FFFF] bg-[#0000AA]/10 p-3">
                    <div className="text-[9px] font-mono font-bold uppercase tracking-wider text-[#FFFF00] mb-2">
                      [ DESCRIPTION ]
                    </div>
                    <p className="text-xs sm:text-sm text-white/90 leading-relaxed font-mono break-words">
                      {company.description}
                    </p>
                  </div>

                  <div className="flex flex-col gap-2">
                    {company.website && (
                      <a
                        href={company.website}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="px-4 py-2.5 bg-[#00FF00] text-black font-mono font-bold text-[10px] sm:text-xs uppercase tracking-wider hover:bg-[#00FFFF] transition-all text-center"
                      >
                        [LINK: WEBSITE]
                      </a>
                    )}
                    {company.twitter && (
                      <a
                        href={company.twitter}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="px-4 py-2.5 border-2 border-[#00FFFF] text-[#00FFFF] font-mono font-bold text-[10px] sm:text-xs uppercase tracking-wider hover:bg-[#00FFFF]/10 transition-all text-center"
                      >
                        [LINK: TWITTER/X]
                      </a>
                    )}
                  </div>
                </div>
              </div>

              {/* SECTION 2: MISSION */}
              <div id="mission" className="scroll-mt-4">
                <div className="border border-[#00FFFF]/30 bg-[#0000AA]/20 p-2 mb-3">
                  <div className="font-mono text-[9px] sm:text-[10px] text-[#FF00FF] uppercase tracking-wider">
                    &gt;&gt; SECT_02: MISSION
                  </div>
                </div>

                <div className="space-y-3">
                  <h2 className="text-2xl sm:text-3xl font-black uppercase font-mono tracking-wide text-[#00FFFF] break-words">
                    WHAT_THEY'RE_BUILDING
                  </h2>

                  {company.whyWeLoveThem && (
                    <div className="bg-black border-2 border-[#00FFFF] p-3">
                      <p className="text-[9px] sm:text-[10px] uppercase tracking-wider text-[#00FFFF] font-bold mb-2 font-mono">
                        [ WHY_WE_LOVE_{company.name.toUpperCase().replace(/\s+/g, '_')} ]
                      </p>
                      <p className="text-white/90 leading-relaxed text-xs sm:text-sm font-mono break-words">
                        {company.whyWeLoveThem}
                      </p>
                    </div>
                  )}
                </div>
              </div>

              {/* SECTION 3: FUNDING */}
              <div id="funding" className="scroll-mt-4">
                <div className="border border-[#00FFFF]/30 bg-[#0000AA]/20 p-2 mb-3">
                  <div className="font-mono text-[9px] sm:text-[10px] text-[#FF00FF] uppercase tracking-wider">
                    &gt;&gt; SECT_03: FUNDING
                  </div>
                </div>

                <div className="space-y-3">
                  <h2 className="text-2xl sm:text-3xl font-black uppercase font-mono tracking-wide text-[#FFFF00] break-words">
                    CAPITAL_RAISED
                  </h2>

                  <div className="bg-black border-2 border-[#00FFFF] p-4">
                    <p className="text-[9px] sm:text-[10px] uppercase tracking-widest text-[#00FFFF] mb-2 font-mono font-bold">
                      [ DATA: FUNDING_AMT ]
                    </p>
                    <p className="text-3xl sm:text-4xl font-black text-[#00FFFF] font-mono tracking-tight mb-2">
                      {formatCurrency(company.funding.amount)}
                    </p>
                    <p className="text-[10px] sm:text-xs text-[#00FFFF]/70 font-mono uppercase tracking-wide">
                      {company.funding.round} / {company.funding.date}
                    </p>
                  </div>
                </div>
              </div>

              {/* SECTION 4: TEAM */}
              <div id="team" className="scroll-mt-4">
                <div className="border border-[#00FFFF]/30 bg-[#0000AA]/20 p-2 mb-3">
                  <div className="font-mono text-[9px] sm:text-[10px] text-[#FF00FF] uppercase tracking-wider">
                    &gt;&gt; SECT_04: TEAM
                  </div>
                </div>

                <div className="space-y-3">
                  <h2 className="text-2xl sm:text-3xl font-black uppercase font-mono tracking-wide text-[#00FFFF] break-words">
                    THE_MINDS
                  </h2>

                  <div className="space-y-2">
                    {company.founders.map((founder, index) => (
                      <a
                        key={founder.id}
                        href={founder.twitter}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex items-center gap-3 p-3 bg-black border border-[#00FF00] hover:bg-[#00FF00]/10 hover:border-[#00FFFF] transition-all group"
                      >
                        {founder.avatar && (
                          <Image
                            src={founder.avatar}
                            alt={founder.name}
                            width={50}
                            height={50}
                            className="border border-[#00FF00] group-hover:border-[#00FFFF] transition-all flex-shrink-0"
                          />
                        )}
                        <div className="flex-1 min-w-0">
                          <div className="text-[8px] sm:text-[9px] font-mono font-bold uppercase tracking-wider text-[#00FF00]/70 mb-1">
                            MEM_{(index + 1).toString().padStart(2, '0')}
                          </div>
                          <h3 className="text-sm sm:text-base font-black text-white group-hover:text-[#00FFFF] transition-colors font-mono uppercase tracking-wide truncate">
                            {founder.name.toUpperCase()}
                          </h3>
                          <p className="text-[#00FF00] text-[9px] sm:text-[10px] font-mono uppercase tracking-wide truncate">
                            {founder.role.toUpperCase()}
                          </p>
                        </div>
                        <span className="text-lg opacity-0 group-hover:opacity-100 transition-opacity text-[#00FFFF] font-mono flex-shrink-0">
                          →
                        </span>
                      </a>
                    ))}
                  </div>
                </div>
              </div>

              {/* SECTION 5: ZERO_FINANCE */}
              <div id="zero" className="scroll-mt-4 pb-4">
                <div className="border border-[#00FFFF]/30 bg-[#0000AA]/20 p-2 mb-3">
                  <div className="font-mono text-[9px] sm:text-[10px] text-[#FF00FF] uppercase tracking-wider">
                    &gt;&gt; SECT_05: ZERO_FINANCE
                  </div>
                </div>

                <div className="space-y-4">
                  <h2 className="text-2xl sm:text-3xl font-black text-[#FF00FF] uppercase font-mono tracking-tight leading-tight break-words">
                    MAX_RUNWAY
                  </h2>

                  <StartupCalculatorSection
                    companyName={company.name}
                    fundingAmount={company.funding.amount}
                    isMobile={true}
                  />

                  <div className="flex flex-col gap-2">
                    <Link
                      href="https://0.finance"
                      className="text-center px-4 py-3 bg-[#00FF00] text-black font-bold font-mono uppercase tracking-wider hover:bg-[#00FFFF] transition-all text-[10px] sm:text-xs border border-[#00FF00] hover:border-[#00FFFF]"
                    >
                      [ START_EARNING_8%_APY ]
                    </Link>
                    <Link
                      href="/"
                      className="text-center px-4 py-3 border border-[#00FFFF] text-[#00FFFF] font-mono font-bold uppercase tracking-wider hover:bg-[#00FFFF]/10 transition-all text-[10px] sm:text-xs"
                    >
                      [ BROWSE_MORE ]
                    </Link>
                  </div>
                </div>
              </div>

            </div>
          </div>

          {/* CAD Command Line Footer */}
          <div className="bg-[#0000AA] text-white font-mono text-[8px] sm:text-[9px] px-2 py-1 sm:py-1.5 border-t border-[#00FFFF]/30 space-y-0.5 flex-shrink-0">
            <div className="truncate">
              <span className="text-[#00FFFF]">Orden:</span> <span className="text-white">_VIEW_{activeSection.toUpperCase()}</span>
            </div>
            <div className="text-[#FFFFFF]/70 truncate">
              {company.name} - Viewport {SECTIONS.findIndex(s => s.id === activeSection) + 1} of {SECTIONS.length}
            </div>
          </div>
        </div>
      )}

      {/* AutoCAD-style Right Sidebar Navigation (desktop only) */}
      {!isMobile && (
        <div
          className="fixed right-0 top-0 h-screen w-64 bg-[#0000AA] border-l-2 border-[#00FFFF] z-50 flex flex-col"
          style={{ fontFamily: 'monospace' }}
        >
          {/* Header */}
          <div className="border-b-2 border-[#00FFFF] p-4 bg-[#0000AA]">
            <div className="text-[#FFFFFF] text-sm font-bold uppercase tracking-widest">
              ACAD_INTERFACE
            </div>
            <div className="text-[#00FF00] text-xs mt-1 uppercase tracking-wide">
              WE_LOVE_YOUR_STARTUP
            </div>
          </div>

          {/* Section Navigation */}
          <div className="flex-1 overflow-y-auto">
            <div className="p-2">
              <div className="text-[#00FFFF] text-xs font-bold uppercase tracking-wider mb-2 px-2">
                [ SECTIONS ]
              </div>
              {SECTIONS.map((section, index) => (
                <button
                  key={section.id}
                  onClick={() => navigateToSection(section.id)}
                  className={`w-full text-left px-3 py-3 mb-1 font-mono text-sm uppercase tracking-wide transition-all ${
                    activeSection === section.id
                      ? 'bg-[#00FFFF] text-[#0000AA] font-bold'
                      : 'text-[#FFFFFF] hover:bg-[#FFFFFF]/10'
                  }`}
                  style={{
                    borderLeft: activeSection === section.id ? `4px solid ${section.color}` : '4px solid transparent',
                  }}
                >
                  {String(index + 1).padStart(2, '0')} {section.label}
                </button>
              ))}
            </div>
          </div>

          {/* Footer Info */}
          <div className="border-t-2 border-[#00FFFF] p-4 bg-[#0000AA]">
            <div className="text-[#00FF00] text-xs uppercase tracking-wide">
              Orden: _navigate
            </div>
            <div className="text-[#FFFFFF]/60 text-xs mt-1">
              VIEWPORT: {activeSection.toUpperCase()}
            </div>
          </div>
        </div>
      )}

      {/* Main Content - Full-screen sections on desktop only */}
      {!isMobile && (
        <div className="lg:pr-64">
          <div>

          {/* SECTION 1: COMPANY */}
          <section
            id="company"
            className="min-h-screen flex flex-col justify-center px-16 py-16"
          >
            <div className="text-xs uppercase tracking-widest text-[#FF00FF] font-mono font-bold mb-8">
              {'>> SECTION_01: COMPANY'}
            </div>

            <div className="flex flex-col lg:flex-row gap-12 items-start">
              <div className="flex-1 max-w-3xl">
                <div className="inline-block px-3 py-1 bg-black border-2 border-[#00FF00] text-sm text-[#00FF00] mb-8 font-mono font-bold uppercase tracking-wider">
                  CATEGORY: {company.category.toUpperCase()}
                </div>

                <h1 className="text-8xl lg:text-9xl font-black tracking-tight leading-none uppercase font-mono mb-6"
                  style={{
                    color: '#00FFFF',
                    letterSpacing: '0.05em'
                  }}>
                  {company.name.toUpperCase()}
                </h1>

                <p className="text-2xl lg:text-3xl font-mono max-w-4xl tracking-wide uppercase font-bold text-[#00FF00] mb-10">
                  // {company.tagline.toUpperCase()}
                </p>

                <div className="mb-10">
                  <div className="text-sm font-mono font-bold uppercase tracking-wider text-[#FFFF00] mb-3">
                    [ DESCRIPTION ]
                  </div>
                  <p className="text-xl lg:text-2xl text-white/90 leading-relaxed font-mono">
                    {company.description}
                  </p>
                </div>

                <div className="flex flex-wrap gap-4">
                  {company.website && (
                    <a
                      href={company.website}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="px-10 py-5 bg-[#00FF00] text-black font-mono font-bold text-lg uppercase tracking-wider hover:bg-[#00FFFF] transition-all"
                    >
                      [LINK: WEBSITE]
                    </a>
                  )}
                  {company.twitter && (
                    <a
                      href={company.twitter}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="px-10 py-5 border-2 border-[#00FFFF] text-[#00FFFF] font-mono font-bold text-lg uppercase tracking-wider hover:bg-[#00FFFF]/10 transition-all"
                    >
                      [LINK: TWITTER/X]
                    </a>
                  )}
                </div>
              </div>

              {/* Shuttle 3D Model - on right */}
              {!isMobile && (
                <div className="w-full lg:w-[450px] h-[450px] flex-shrink-0">
                  <div className="w-full h-full relative border-t border-b border-[#00FF00]" style={{ backgroundColor: '#000000' }}>
                    <Canvas
                      camera={{ position: [0, 0, 140], fov: 75 }}
                      dpr={[1, 1.5]}
                      performance={{ min: 0.5 }}
                      style={{ backgroundColor: '#000000' }}
                    >
                      <PerspectiveCamera makeDefault position={[0, 0, 140]} fov={75} />
                      <ambientLight intensity={0.2} />
                      <directionalLight position={[5, 5, 5]} intensity={0.4} />
                      <Suspense fallback={null}>
                        <WireframeRocket
                          scrollProgress={0}
                          rotation={{ x: -0.80, y: 0.64, z: -2.46 }}
                          scale={0.09}
                          position={{ x: 0, y: 0, z: 0 }}
                          customModelPath={company.model3d}
                        />
                      </Suspense>
                      <EffectComposer>
                        <Bloom intensity={0.6} luminanceThreshold={0.7} radius={0.3} />
                        <primitive object={new GlitchEffect()} />
                        <ChromaticAberration offset={[0.005, 0.005]} />
                        <Noise opacity={0.05} />
                      </EffectComposer>
                    </Canvas>
                  </div>
                </div>
              )}
            </div>
          </section>

          {/* SECTION 2: MISSION */}
          <section
            id="mission"
            className="min-h-screen flex flex-col justify-center px-16 py-16"
          >
            <div className="text-xs uppercase tracking-widest text-[#FF00FF] font-mono font-bold mb-8">
              {'>> SECTION_02: MISSION'}
            </div>

            <div className="flex flex-col lg:flex-row gap-12 items-start">
              <div className="flex-1 space-y-8 max-w-3xl">
                <h2 className="text-6xl lg:text-7xl font-black uppercase font-mono tracking-wide"
                  style={{ color: '#00FFFF' }}>
                  WHAT_THEY'RE_BUILDING
                </h2>

                {company.whyWeLoveThem && (
                  <div className="bg-black border-2 border-[#00FFFF] p-10">
                    <p className="text-sm uppercase tracking-wider text-[#00FFFF] font-bold mb-6 font-mono">
                      [ NOTE: WHY_WE_LOVE_{company.name.toUpperCase().replace(/\s+/g, '_')} ]
                    </p>
                    <p className="text-white/90 leading-relaxed text-xl lg:text-2xl font-mono">
                      {company.whyWeLoveThem}
                    </p>
                  </div>
                )}
              </div>

              {/* 3D Model - Apollo Soyuz - on right */}
              {!isMobile && (
                <div className="w-full lg:w-[450px] h-[450px] flex-shrink-0">
                  <div className="w-full h-full relative border-t border-b border-[#00FF00]" style={{ backgroundColor: '#000000' }}>
                    <Canvas
                      camera={{ position: [0, 0, 15], fov: 75 }}
                      dpr={[1, 1.5]}
                      performance={{ min: 0.5 }}
                      style={{ backgroundColor: '#000000' }}
                    >
                      <PerspectiveCamera makeDefault position={[0, 0, 15]} fov={75} />
                      <ambientLight intensity={0.2} />
                      <directionalLight position={[5, 5, 5]} intensity={0.4} />
                      <Suspense fallback={null}>
                        <WireframeRocket
                          scrollProgress={1 / 3}
                          rotation={{ x: -1.2, y: 0, z: -0.5 }}
                          scale={0.7}
                          position={{ x: 0, y: 0, z: 12.0 }}
                          customModelPath={company.model3d}
                        />
                      </Suspense>
                      <EffectComposer>
                        <primitive object={new DitherWaveEffect()} />
                        <Bloom intensity={0.4} luminanceThreshold={0.8} radius={0.2} />
                      </EffectComposer>
                    </Canvas>
                  </div>
                </div>
              )}
            </div>
          </section>

          {/* SECTION 3: FUNDING */}
          <section
            id="funding"
            className="min-h-screen flex flex-col justify-center px-16 py-16"
          >
            <div className="text-xs uppercase tracking-widest text-[#FF00FF] font-mono font-bold mb-8">
              {'>> SECTION_03: FUNDING'}
            </div>

            <h2 className="text-6xl lg:text-7xl font-black uppercase font-mono tracking-wide mb-10"
              style={{ color: '#FFFF00' }}>
              CAPITAL_RAISED
            </h2>

            <div className="max-w-3xl">
              <div className="bg-black border-3 border-[#00FFFF] p-10 border-2">
                <p className="text-sm uppercase tracking-widest text-[#00FFFF] mb-6 font-mono font-bold">
                  [ DATA: FUNDING_AMOUNT ]
                </p>
                <p className="text-6xl lg:text-7xl font-black text-[#00FFFF] font-mono tracking-tight mb-4">
                  {formatCurrency(company.funding.amount)}
                </p>
                <p className="text-lg text-[#00FFFF]/70 font-mono uppercase tracking-wide">
                  {company.funding.round} / {company.funding.date}
                </p>
              </div>
            </div>
          </section>

          {/* SECTION 4: TEAM */}
          <section
            id="team"
            className="min-h-screen flex flex-col justify-center px-16 py-16"
          >
            <div className="text-xs uppercase tracking-widest text-[#FF00FF] font-mono font-bold mb-8">
              {'>> SECTION_04: TEAM'}
            </div>

            <div className="flex flex-col lg:flex-row gap-12 items-start">
              <div className="flex-1 space-y-8">
                <h2 className="text-6xl lg:text-7xl font-black uppercase font-mono tracking-wide"
                  style={{ color: '#00FFFF' }}>
                  THE_BRILLIANT_MINDS
                </h2>

                <div className="space-y-5 max-w-2xl">
                  {company.founders.map((founder, index) => (
                    <a
                      key={founder.id}
                      href={founder.twitter}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="flex items-center gap-6 p-8 bg-black border-2 border-[#00FF00] hover:bg-[#00FF00]/10 hover:border-[#00FFFF] transition-all group"
                    >
                      {founder.avatar && (
                        <Image
                          src={founder.avatar}
                          alt={founder.name}
                          width={70}
                          height={70}
                          className="border-2 border-[#00FF00] group-hover:border-[#00FFFF] transition-all"
                        />
                      )}
                      <div className="flex-1">
                        <div className="text-xs font-mono font-bold uppercase tracking-wider text-[#00FF00]/70 mb-2">
                          MEMBER_{(index + 1).toString().padStart(2, '0')}
                        </div>
                        <h3 className="text-2xl lg:text-3xl font-black text-white group-hover:text-[#00FFFF] transition-colors font-mono uppercase tracking-wide">
                          {founder.name.toUpperCase()}
                        </h3>
                        <p className="text-[#00FF00] mt-2 text-lg font-mono uppercase tracking-wide">
                          ROLE: {founder.role.toUpperCase()}
                        </p>
                      </div>
                      <span className="text-2xl opacity-0 group-hover:opacity-100 transition-opacity text-[#00FFFF] font-mono">
                        [→]
                      </span>
                    </a>
                  ))}
                </div>
              </div>

              {/* 3D Model - Space Suit - on right */}
              {!isMobile && (
                <div className="w-full lg:w-[450px] h-[450px] flex-shrink-0">
                  <div className="w-full h-full relative border-t border-b border-[#00FF00]" style={{ backgroundColor: '#000000' }}>
                    <Canvas
                      camera={{ position: [0, 0, 15], fov: 75 }}
                      dpr={[1, 1.5]}
                      performance={{ min: 0.5 }}
                      style={{ backgroundColor: '#000000' }}
                    >
                      <PerspectiveCamera makeDefault position={[0, 0, 15]} fov={75} />
                      <ambientLight intensity={0.2} />
                      <directionalLight position={[5, 5, 5]} intensity={0.4} />
                      <Suspense fallback={null}>
                        <WireframeRocket
                          scrollProgress={2 / 3}
                          rotation={{ x: -1.2, y: 0, z: -0.5 }}
                          scale={0.7}
                          position={{ x: 0, y: 0, z: 12.0 }}
                          customModelPath={company.model3d}
                        />
                      </Suspense>
                      <EffectComposer>
                        <primitive object={new HologramEffect()} />
                        <Bloom intensity={1.2} luminanceThreshold={0.5} radius={0.5} />
                      </EffectComposer>
                    </Canvas>
                  </div>
                </div>
              )}
            </div>
          </section>

          {/* SECTION 5: ZERO_FINANCE (Separate Plug/Shill) */}
          <section
            id="zero"
            className="min-h-screen flex flex-col justify-center px-16 py-16"
          >
            <div className="text-xs uppercase tracking-widest text-[#FF00FF] font-mono font-bold mb-8">
              {'>> SECTION_05: ZERO_FINANCE'}
            </div>

            <div className="max-w-4xl space-y-10">
              <h2 className="text-6xl lg:text-8xl font-black text-[#FF00FF] uppercase font-mono tracking-tighter leading-tight">
                MAXIMIZE_YOUR_RUNWAY
              </h2>

              <StartupCalculatorSection
                companyName={company.name}
                fundingAmount={company.funding.amount}
                isMobile={false}
              />

              <div className="flex flex-col sm:flex-row gap-5">
                <Link
                  href="https://0.finance"
                  className="flex-1 text-center px-12 py-6 bg-[#00FF00] text-black font-bold font-mono uppercase tracking-wider hover:bg-[#00FFFF] transition-all text-lg border-2 border-[#00FF00] hover:border-[#00FFFF]"
                >
                  [ ACTION: START_EARNING_8%_APY ]
                </Link>
                <Link
                  href="/"
                  className="text-center px-12 py-6 border-2 border-[#00FFFF] text-[#00FFFF] font-mono font-bold uppercase tracking-wider hover:bg-[#00FFFF]/10 transition-all text-lg"
                >
                  [ RETURN: BROWSE_MORE_STARTUPS ]
                </Link>
              </div>
            </div>
          </section>

          </div>
        </div>
      )}
    </div>
  );
}
